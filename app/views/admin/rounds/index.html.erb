<%# app/views/admin/rounds/index.html.erb %>

<div class="container mx-auto px-4 py-8">
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-3xl font-bold text-gray-800">Gerenciar Rodadas</h1>
    <%= link_to 'Nova Rodada', new_admin_round_path, class: 'btn btn-primary px-4 py-2' %>
  </div>

  <% if @rounds.empty? %>
    <p class="text-gray-600">Nenhuma rodada cadastrada ainda.</p>
  <% else %>
    <div class="bg-white shadow-md rounded-lg overflow-hidden">
      <table class="min-w-full leading-normal">
        <thead>
          <tr>
            <th class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
              Número
            </th>
            <th class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
              Status
            </th>
            <th class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
              Data de Finalização
            </th>
            <th class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100"></th>
          </tr>
        </thead>
        <tbody>
          <% @rounds.each do |round| %>
            <tr class="hover:bg-gray-50">
              <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm">
                <%= link_to round.number, admin_round_path(round), class: "text-blue-600 hover:underline" %>
              </td>
              <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm">
                <span class="relative inline-block px-3 py-1 font-semibold leading-tight <%= round.finalized? ? 'text-green-900' : 'text-yellow-900' %>">
                  <span aria-hidden="true" class="absolute inset-0 <%= round.finalized? ? 'bg-green-200' : 'bg-yellow-200' %> opacity-50 rounded-full"></span>
                  <span class="relative"><%= round.status.capitalize %></span>
                </span>
              </td>
              <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm">
                <%= round.finalized_at&.strftime('%d/%m/%Y %H:%M') || 'N/A' %>
              </td>
              <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm text-right">
                <div class="flex justify-end space-x-2">
                  <%= link_to 'Visualizar', admin_round_path(round), class: 'text-blue-600 hover:text-blue-900' %>
                  <%= link_to 'Editar', edit_admin_round_path(round), class: 'text-indigo-600 hover:text-indigo-900' %>
                  <% unless round.finalized? %>
                    <%= button_to 'Finalizar Rodada', finalize_admin_round_path(round), method: :patch,
                                  data: { turbo_confirm: 'Tem certeza que deseja FINALIZAR esta rodada? Isso irá finalizar todas as partidas associadas e calcular os pontos dos bolões!', confirm_button_text: 'Sim, Finalizar', cancel_button_text: 'Cancelar' },
                                  class: 'btn btn-sm btn-success' %>
                  <% end %>
                  <%= button_to 'Excluir', admin_round_path(round), method: :delete,
                                data: { turbo_confirm: 'Tem certeza que deseja EXCLUIR esta rodada? Isso não afetará as partidas, mas removerá a associação da rodada delas.', confirm_button_text: 'Sim, Excluir', cancel_button_text: 'Cancelar' },
                                class: 'btn btn-sm btn-danger' %>
                </div>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  <% end %>
</div>